<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: QM&trade; Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    <doxygen-awesome-dark-mode-toggle id="dark-mode-toggle" title="Toggle Light/Dark Mode"></doxygen-awesome-dark-mode-toggle>
    QM
    &nbsp;<span id="projectnumber">5.1.3</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
   <div style="padding: 0.5em;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gs_tut.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">QM&trade; Tutorial </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gs_tut_video">QM Tutorial Video</a></li>
<li class="level1"><a href="#gs_tut_new">Creating New Model from Scratch</a></li>
<li class="level1"><a href="#gs_tut_template">Creating Blinky Model from Template</a></li>
<li class="level1"><a href="#gs_tut_add">Adding Model Items</a><ul><li class="level2"><a href="#gs_tut_add-package">Add a Package</a></li>
<li class="level2"><a href="#gs_tut_add-class">Add a Class</a></li>
<li class="level2"><a href="#gs_tut_add-timer">Add a Time Event</a></li>
<li class="level2"><a href="#gs_tut_add-sm">Add State Machine</a></li>
</ul>
</li>
<li class="level1"><a href="#gs_tut_draw">Drawing State Machine Diagram</a><ul><li class="level2"><a href="#gs_tut_draw-state">Add States</a></li>
<li class="level2"><a href="#gs_tut_draw-initial">Add Initial Transition</a></li>
<li class="level2"><a href="#gs_tut_draw-tran">Add Transitions</a></li>
</ul>
</li>
<li class="level1"><a href="#gs_tut_ce">Generating Code</a><ul><li class="level2"><a href="#gs_tut_ce-dir">Add Directory</a></li>
<li class="level2"><a href="#gs_tut_ce-file">Add File</a></li>
<li class="level2"><a href="#gs_tut_ce-code">Edit File</a></li>
<li class="level2"><a href="#gs_tut_ce-gen">Generate Code</a></li>
</ul>
</li>
<li class="level1"><a href="#gs_tut_build">Building the Project</a><ul><li class="level2"><a href="#gs_tut_win">Building Blinky on Windows</a></li>
<li class="level2"><a href="#gs_tut_linux">Building Blinky on Linux (POSIX)</a></li>
<li class="level2"><a href="#gs_tut_emb">Building Blinky for an Embedded Board</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p >This tutorial describes how to use QM&trade; to model and implement a simple "Blinky" application, which can blink an LED on an embedded board or just print the state changes of the LED to the screen when executed on the desktop. </p>
<dl class="section note"><dt>Note</dt><dd>This tutorial assumes <a href="https://www.state-machine.com/qpc">QP/C Framework</a> (version <b>6</b>). To work with other QP framework types (<a href="https://www.state-machine.com/qpcpp">QP/C++</a> or <a href="https://www.state-machine.com/qpn">QP-nano</a>) it is recommended to create your Blinky model from a <b>model template</b> for the specific framework type, as <a class="el" href="gs_tut.html#gs_tut_template">described below</a>.</dd></dl>
<h1><a class="anchor" id="gs_tut_video"></a>
QM Tutorial Video</h1>
<p >If you prefer to watch the <a href="https://youtu.be/VJpTJaGPrVk"><b>video version of this tutorial</b></a>, it is available on the <a href="https://www.youtube.com/c/StateMachineCOM">Quantum Leaps YouTube Channel</a>:</p>
<p >
<div class="image">
<a target="_blank" href="https://youtu.be/VJpTJaGPrVk">
  <img border="0" src="img/qm_tut_video.jpg" title="Watch video">
</a>
</div>
</p>
<div style="clear:both;"></div><h1><a class="anchor" id="gs_tut_new"></a>
Creating New Model from Scratch</h1>
<p >To create a new model, go to <span class="menu">File-&gt;New Model...</span> menu or press the <span class="img new_model">New Model</span> button in the <a class="el" href="ui_toolbars.html#ui_toolbar_edit">Edit Toolbar</a>. This will open the following <a class="el" href="ui_new-dlg.html">New Model Dialog Box</a> :</p>
<p ><img src="new_model.png" alt="" class="inline" title="New Model dialog"/></p>
<ul>
<li>Select the <b>QP framework type</b> you want to base the new model on (the "Frameworks" panel). The choices are: <code>qpc</code> for QP/C&trade;, <code>qpcpp</code> for QP/C++&trade;, and <code>qpn</code> for QP-nano&trade;. For this tutorial, you leave the default <b>qpc</b> framework type.</li>
<li>Choose the <b>model template</b> for your model ("Templates" panel). If you don't select the template and leave at "None", your model will be empty, except the selected framework. For this tutorial, you leave the default template <b>None</b>, so that you can start building your model from scratch.</li>
<li>Name your model ("Name:" field). <span class="highlight">NOTE: the <code>.qm</code> extension will be added automatically.</span> For this tutorial, you rename the model to <code>blinky</code>.</li>
<li>Choose the directory for your model file ("Location:" field). You can either type in the path manually, or you can press the <span class="img search_folder">&#160;</span> button to open the directory-search dialog box. For this tutorial, you choose the model location to <code>&lt;your-directory&gt;\blinky</code>, where <code>&lt;your-directory&gt;</code> is a directory of your choice. <span class="highlight">NOTE: the model directory provides also the reference point for the code generation. All generated directories and files are relative to the model file directory.</span></li>
<li>Press the <span class="button">OK</span> button.</li>
<li>If you wish to build the model from scratch, skip the next section and proceed to <a class="el" href="gs_tut.html#gs_tut_add">Adding Model Items</a>.</li>
</ul>
<h1><a class="anchor" id="gs_tut_template"></a>
Creating Blinky Model from Template</h1>
<p >Alternatively, you can create the Blinky model from the Provided Template. As shown in the screen shot below, you select the <code>blinky.qm</code> Template in the New Model dialog:</p>
<p ><img src="new_blinky.png" alt="" class="inline" title="The Blinky template in New Model dialog"/></p>
<p >When you close the dialog with the <span class="button">OK</span> button in this case, the blinky model will be copied from the provided template and will be ready. You can inspect the model, show the Blinky <a class="el" href="gs_tut.html#gs_tut_draw">state diagram</a>, <a class="el" href="gs_tut.html#gs_tut_ce-gen">generate code from it</a>, <a class="el" href="gs_tut.html#gs_tut_build">build the application</a> and run it on your desktop PC.</p>
<dl class="section attention"><dt>Attention</dt><dd>The blinky model templates are available for all QP framework types (QP/C, QP/C++ and QP-nano), not just for QP/C. These model templates are a bit more advanced than the model you will create from scratch in the rest of this Tutorial. The models created from these templates are annotated with comments and documentation and it is <b>highly recommended</b> that you get familiar with the structure of these models.</dd></dl>
<h1><a class="anchor" id="gs_tut_add"></a>
Adding Model Items</h1>
<p >Now you can to start adding items to the new model.</p>
<h2><a class="anchor" id="gs_tut_add-package"></a>
Add a Package</h2>
<p >The first item you add is a <a class="el" href="bm_package.html">Package</a>. A package in UML is a grouping construct that allows you to combine other model items into a higher-level unit&mdash;the package. The most common use of a package is to group together <a class="el" href="bm_class.html">classes</a>, but a package can hold also <a class="el" href="bm_attr.html">free attributes</a>, free operations, and even other <a class="el" href="bm_package.html">packages</a>.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img model">blinky</span> model item to get a popup-menu specific to that item. Once the popup menu opens, select <span class="menu">Add Package</span>.</li>
</ul>
<p ><img src="add_package.png" alt="" class="inline" title="Add Package"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the package name to <code>AOs</code> (Active Objects) and the stereotype to <code>components</code>.</li>
</ul>
<p ><img src="blinky_package.png" alt="" class="inline" title="Package Properties"/></p>
<h2><a class="anchor" id="gs_tut_add-class"></a>
Add a Class</h2>
<p >Next you need to add a <a class="el" href="bm_class.html">class</a> to the new package, because only classes can have behavior (i.e., <a class="el" href="sm.html">State Machines</a>).</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img package_comp">AOs</span> package and select <span class="menu">Add Class</span> from the popup menu.</li>
</ul>
<p ><img src="add_class.png" alt="" class="inline" title="Add Class"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the class name to <code>Blinky</code> and the superclass to <span class="highlight"><code>qpc::QActive</code></span>.</li>
</ul>
<p ><img src="blinky_class.png" alt="" class="inline" title="Setting Superclass"/></p>
<dl class="section note"><dt>Note</dt><dd>In QM&trade; a State Machine can be associated only with a <a class="el" href="bm_class.html">class</a> that inherits one of the <a class="el" href="sm.html#sm_class">QP state machine classes</a>. The choice of the state machine superclass determines the <a class="el" href="ce_sm.html#ce_sm_strategy">state machine implementation strategy</a>.</dd></dl>
<h2><a class="anchor" id="gs_tut_add-timer"></a>
Add a Time Event</h2>
<p >Next, you need to add a <b>Time Event</b> attribute that will deliver the periodic stimulus to trigger blinking in your <code>Blinky</code> state machine.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img class_active">Blinky</span> class and select <span class="menu">Add Attribute</span> from the popup menu.</li>
</ul>
<p ><img src="blinky_a1.png" alt="" class="inline" title="Adding Attribute"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the attribute name to <code>timeEvt</code>, the type to <code>qpc::QTimeEvt</code>, and visibility to <code>private</code>.</li>
</ul>
<p ><img src="blinky_a2.png" alt="" class="inline" title="Attribute Properties"/></p>
<h2><a class="anchor" id="gs_tut_add-sm"></a>
Add State Machine</h2>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img class_active">Blinky</span> class and select <span class="menu">Add State Machine</span> from the popup menu.</li>
</ul>
<p ><img src="blinky_sm_add.png" alt="" class="inline" title="Adding State Machine"/></p>
<h1><a class="anchor" id="gs_tut_draw"></a>
Drawing State Machine Diagram</h1>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img statechart">SM</span> (State Machine) item and select <span class="menu">Show Diagram</span> from the popup menu. Alternatively you can just <b>double</b>-click on the <span class="img statechart">SM</span> item to execute its <b>default action</b>, which is to show the diagram.</li>
</ul>
<p ><img src="Show State Machine Diagram" alt="blinky_sm_show.png" class="inline"/></p>
<h2><a class="anchor" id="gs_tut_draw-state"></a>
Add States</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img state">state</span> tool. Move your mouse (all mouse buttons released) to the diagram window where you want to position the upper-left corner of the state shape. Notice the new shape of the mouse cursor (shown on the right). Click the mouse and drag it (with mouse button depressed) to the location of the lower-right corner of the state shape. Release the mouse.</li>
</ul>
<p ><img src="Adding the off State" alt="blinky_state_add.gif" class="inline"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the state name to <code>off</code> and add the entry action to this state <code>BSP_ledOff();</code>.</li>
<li>In the similar way as before add second state. In the <a class="el" href="ui_prop.html">Property Editor</a> change the state name to <code>on</code> and add the entry action to this state <code>BSP_ledOn();</code>.</li>
</ul>
<h2><a class="anchor" id="gs_tut_draw-initial"></a>
Add Initial Transition</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img initial"></span> initial transition tool. Move your mouse (all mouse buttons released) to the diagram window where you want to position the begin of the initial transition shape. Notice the new shape of the mouse cursor (shown on the right). Click the mouse and drag it (with mouse button depressed) to the edge of the state. Notice the cursor change when you reach the edge. Release the mouse.</li>
</ul>
<p ><img src="blinky_init_add.gif" alt="" class="inline" title="Adding the Initial Transition"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> add action code to this initial transition <code>QTimeEvt_armX(&amp;me-&gt;timeEvt, BSP_TICKS_PER_SEC/2, BSP_TICKS_PER_SEC/2);</code></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The action code of the initial transition arms the time event to expire in <code>BSP_TICKS_PER_SEC/2</code> number of clock ticks (i.e., in 1/2 of a second) and also <b>every</b> <code>BSP_TICKS_PER_SEC/2</code> number of clock ticks (i.e., every 1/2 of a second).</dd></dl>
<h2><a class="anchor" id="gs_tut_draw-tran"></a>
Add Transitions</h2>
<ul>
<li>In the <a class="el" href="ui_toolbox.html">Diagram Toolbox</a> click on the <span class="img tran"></span> transition tool. Move your mouse (all mouse buttons released) to the state edge where you want to position the begin of the transition connector. Notice the new shape of the mouse cursor (<span class="img cur_tran1"></span>). Click the mouse and drag it (with mouse button depressed) to the edge of the state. Notice the cursor change when you reach the edge. Release the mouse.</li>
</ul>
<p ><img src="blinky_tran_add.gif" alt="" class="inline" title="Adding a Transition"/></p>
<ul>
<li>In the <a class="el" href="ui_prop.html">Property Editor</a> change the trigger of this transition to <code>TIMEOUT</code>.</li>
<li>In the similar way as before add second transition and change its trigger also to <code>TIMEOUT</code>.</li>
</ul>
<p ><img src="blinky_sm.png" alt="" class="inline" title="Complete State Machine"/></p>
<h1><a class="anchor" id="gs_tut_ce"></a>
Generating Code</h1>
<p >Compared to most other graphical tools based on state machines, QM&trade; turns the code generation "upside down". QM&trade; lets <b>you</b> determine the generated code structure, directory names, file names, and elements that go into every file (see <a class="el" href="ce.html#ce_phys">Physical Design</a>). You can mix your own code with the generated code and use QM to generate as much or as little of the overall code as you see fit .</p>
<h2><a class="anchor" id="gs_tut_ce-dir"></a>
Add Directory</h2>
<p >First, you need to create a <a class="el" href="ce_dir.html">directory</a>, which will determine the location of the files generated on disk <b>relative</b> to the <a class="el" href="ui_model_file.html">QM Model File</a>.</p>
<p ><img src="Adding a Directory" alt="blinky_dir_add.gif" class="inline"/></p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>right</b>-click on the <span class="img model">blinky</span> model item and select <span class="menu">Add Directory</span> in the popup menu. This will be the <a class="el" href="ce_dir.html">directory</a>, where your code will be generated. The <b>path</b> of the directory <b>relative</b> to the <a class="el" href="ui_model_file.html">QM Model File</a> can be edited in the Property Editor. Type <code>.</code> (dot) for the name of the directory. The dot means the same directory as the <a class="el" href="ui_model_file.html">QM Model File</a>, meaning that your code will be generated in the same directory as your model.</li>
</ul>
<h2><a class="anchor" id="gs_tut_ce-file"></a>
Add File</h2>
<p >Once you have a directory, you can add <a class="el" href="ce_file.html">Files</a> to it. In a real-life project you would typically split the code into header (<code>.h</code>) files, place each active object in its own source (<code>.c</code>) file, and use separate <code>.c</code> files for the Board Support Package (BSP) and <code>main()</code>. But for the sake of simplicity, this tutorial will put the whole implementation in just one file: <code>blinky.c</code>, which you create as follows:</p>
<p ><img src="blinky_file_add.gif" alt="" class="inline" title="Adding a File"/></p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> view <b>right</b>-click on the <span class="img directory">.</span> directory item and select <span class="menu">Add File</span> in the popup menu. After the file is created, you can edit its name in the Property Editor. Type <code>blinky.c</code> in the name box and press Enter. Note that the file icon changes to <span class="img file_source_c">&#160;</span>.</li>
</ul>
<h2><a class="anchor" id="gs_tut_ce-code"></a>
Edit File</h2>
<p >In QM&trade; <b>you</b> provide the body of every <a class="el" href="ce_file.html">file-template</a>, in which you can type your own code as well as <a class="el" href="ce_directive.html">Code-Generation Directives</a>.</p>
<ul>
<li>In the <a class="el" href="ui_explorer.html">Model Explorer</a> <b>double</b>-click on the <span class="img file_c">blinky.c</span> file to open the file in a window. Next copy the following code to the Clipboard and paste it into the file window.</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;qpc.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span> <span class="comment">/* for exit() */</span></div>
<div class="line"> </div>
<div class="line">Q_DEFINE_THIS_FILE</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> { BSP_TICKS_PER_SEC = 100 };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> BSP_ledOff(<span class="keywordtype">void</span>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;LED OFF\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> BSP_ledOn(<span class="keywordtype">void</span>) {</div>
<div class="line">    printf(<span class="stringliteral">&quot;LED ON\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> Q_onAssert(<span class="keywordtype">char</span> <span class="keyword">const</span> * <span class="keyword">const</span> module, <span class="keywordtype">int</span> loc) {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Assertion failed in %s:%d&quot;</span>, module, loc);</div>
<div class="line">    exit(-1);</div>
<div class="line">}</div>
<div class="line"><span class="keywordtype">void</span> QF_onStartup(<span class="keywordtype">void</span>) {}</div>
<div class="line"><span class="keywordtype">void</span> QF_onCleanup(<span class="keywordtype">void</span>) {}</div>
<div class="line"><span class="keywordtype">void</span> QF_onClockTick(<span class="keywordtype">void</span>) {</div>
<div class="line">    QF_TICK_X(0U, (<span class="keywordtype">void</span> *)0);  <span class="comment">/* perform the QF clock tick processing */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">enum</span> BlinkySignals {</div>
<div class="line">    TIMEOUT_SIG = Q_USER_SIG,</div>
<div class="line">    MAX_SIG</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*============== ask QM to declare the Blinky class ================*/</span></div>
<div class="line">$declare${AOs::Blinky}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> Blinky l_blinky;</div>
<div class="line">QActive * <span class="keyword">const</span> AO_Blinky = &amp;l_blinky.super;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> Blinky_ctor(<span class="keywordtype">void</span>) {</div>
<div class="line">    Blinky *me = (Blinky *)AO_Blinky;</div>
<div class="line">    QActive_ctor(&amp;me-&gt;super, Q_STATE_CAST(&amp;Blinky_initial));</div>
<div class="line">    QTimeEvt_ctorX(&amp;me-&gt;timeEvt, &amp;me-&gt;super, TIMEOUT_SIG, 0U);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="comment">/* statically allocate event queue buffer for the Blinky AO */</span></div>
<div class="line">    <span class="keyword">static</span> QEvt <span class="keyword">const</span> *blinky_queueSto[10];</div>
<div class="line"> </div>
<div class="line">    QF_init(); <span class="comment">/* initialize the framework */</span></div>
<div class="line"> </div>
<div class="line">    Blinky_ctor(); <span class="comment">/* explicitly call the &quot;constructor&quot; */</span></div>
<div class="line">    QACTIVE_START(AO_Blinky,</div>
<div class="line">                  1U, <span class="comment">/* priority */</span></div>
<div class="line">                  blinky_queueSto, Q_DIM(blinky_queueSto),</div>
<div class="line">                  (<span class="keywordtype">void</span> *)0, 0U, <span class="comment">/* no stack */</span></div>
<div class="line">                  (QEvt *)0);    <span class="comment">/* no initialization event */</span></div>
<div class="line">    <span class="keywordflow">return</span> QF_run(); <span class="comment">/* run the QF application */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*================ ask QM to define the Blinky class ================*/</span></div>
<div class="line">$define${AOs::Blinky}</div>
<div class="line"> </div>
</div><!-- fragment --><dl class="section attention"><dt>Attention</dt><dd>The listing above shows two most important code generation directives: <a class="el" href="ce_declare.html">$declare${AOs::Blinky}</a> for generating the <a class="el" href="ce_directive.html#ce_directive-decl">Declaration</a> of the <code>Blinky</code> class, and <a class="el" href="ce_define.html">$define${AOs::Blinky}</a> for generating the <a class="el" href="ce_directive.html#ce_directive-def">Definition</a> of the of the <code>Blinky</code> class.</dd></dl>
<p><br  />
<img src="blinky_file_edit.gif" alt="" class="inline" title="Opening blinky.c File and Pasting the Code"/></p>
<h2><a class="anchor" id="gs_tut_ce-gen"></a>
Generate Code</h2>
<ul>
<li>Generate code by pressing the <span class="img codegen">Generate Code</span> button in the Tools toolbar.</li>
</ul>
<p ><img src="blinky_code_gen.gif" alt="" class="inline" title="Code Generation"/></p>
<p >At this point QM&trade; has generated the <code>blinky.c</code> file in the same directory as the <code>blinky.qm</code> <a class="el" href="ui_model_file.html">QM Model File</a>. You can inspect the generated <code>blinky.c</code> file on the disk with your favorite code editor.</p>
<h1><a class="anchor" id="gs_tut_build"></a>
Building the Project</h1>
<p >You build the generated code just as any other hand-crafted code. This simplistic tutorial generated the whole project in just one source file <code>blinky.c</code>.</p>
<dl class="section attention"><dt>Attention</dt><dd>The following sections show how to build the Blinky project from the command-prompt. However, it is also possible to build the project <a class="el" href="ui_tools-dlg.html#ui_tools-dlg_gcc">directly from QM</a>, by defining an external tool in the <a class="el" href="ui_tools-dlg.html">Manage Tools Dialog Box</a>.</dd></dl>
<h2><a class="anchor" id="gs_tut_win"></a>
Building Blinky on Windows</h2>
<p >The Board Support Package (BSP) functions coded at the beginning if the <code>blinky.c</code> file are designed to run on the desktop OS, such as Windows or Linux, because of the <code>printf()</code> statements. Here is how to build the <code>blinky.exe</code> executable on Windows command prompt:</p>
<p ><img src="blinky_win.gif" alt="" class="inline" title="Blinky on Windows"/></p>
<p >First, you set the environment variable <code>QPC</code> to point to the location of the QP/C framework on your machine. Here, <code>QCP=C:\qp\qpc</code>, which is the default location, but if you installed QP/C in <em>different</em> location, you need to set <code>QPC</code> to the actual location on your machine.</p>
<pre class="fragment">set QPC=C:\qp\qpc
</pre><p >Next, you invoke the free <code>gcc</code> compiler to build your <code>blinky.c</code> file. Here, the MinGW <code>gcc</code> is taken from the QTools collection installed in the default <code>C:\qp\qtools\bin</code>.</p>
<pre class="fragment">gcc blinky.c -oblinky.exe -I%QPC%\include -I%QPC%\ports\win32 -L%QPC%\ports\win32\dbg -lqp
</pre><dl class="section note"><dt>Note</dt><dd>On Windows the free <code>gcc</code> compiler is typically not installed, so you need to download and install it. The <a href="https://github.com/QuantumLeaps/qtools/releases" class="extern" target="_blank">QTools collection for Windows</a> contains the MinGW <code>gcc</code> compiler and other Unix-style utilities.</dd></dl>
<p>Finally, you run the produced <code>blinky.exe</code> file, which starts printing to your screen.</p>
<pre class="fragment">blinky
</pre><p >You exit the application by pressing <span class="button">Ctrl+C</span>.</p>
<h2><a class="anchor" id="gs_tut_linux"></a>
Building Blinky on Linux (POSIX)</h2>
<p >Building and running Blinky on the POSIX platforms (such as Linux and MacOS) is a little bit more involved, because the QP framework is built from sources as opposed to being linked as a pre-built library. The recommended procedure is to create the Blinky model from the <a class="el" href="gs_tut.html#gs_tut_template">existing template</a>, which also generates the <code>Makefile</code> for building the application. The following screen shot shows how to build and run the Blinky project on Linux:</p>
<p ><img src="blinky_linux.gif" alt="" class="inline" title="Blinky on Linux"/></p>
<h2><a class="anchor" id="gs_tut_emb"></a>
Building Blinky for an Embedded Board</h2>
<p >To build the Blinky project for an embedded board, you need to modify the BSP (Board Support Package), to turn the LED on and off. You also need to use the specific cross-compiler. Please refer to the <a href="https://youtu.be/O7ER6_VqIH0" class="extern" target="_blank">"Getting Started" video</a> for more information about getting started with the QP frameworks. Also, you might read "Getting Started" Application Notes: <a href="https://www.state-machine.com/doc/AN_Getting_Started_with_QPC.pdf" class="extern" target="_blank">QP/C</a>, <a href="https://www.state-machine.com/doc/AN_Getting_Started_with_QPCpp.pdf" class="extern" target="_blank">QP/C++</a>, and <a href="https://www.state-machine.com/doc/AN_Getting_Started_with_QP-nano.pdf" class="extern" target="_blank">QP-nano</a>.</p>
<p ><img src="blinky_ek-tm4c123gxl.gif" alt="" class="inline" title="Blinky on TivaC LaunchPad"/></p>
<hr  />
<p><b>Next:</b> <a class="el" href="gs_examples.html">QM&trade; Examples</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2021 Quantum Leaps</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
