<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: Working with Events</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    <doxygen-awesome-dark-mode-toggle id="dark-mode-toggle" title="Toggle Light/Dark Mode"></doxygen-awesome-dark-mode-toggle>
    QM
    &nbsp;<span id="projectnumber">5.1.3</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
   <div style="padding: 0.5em;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('bm_evt.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Working with Events </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#bm_evt-sig">Event Signals</a></li>
<li class="level1"><a href="#bm_evt-param">Event Parameters</a></li>
<li class="level1"><a href="#bm_evt-decl">Declaring Event Classes</a></li>
<li class="level1"><a href="#bm_evt-using">Using Event Classes in the Code</a></li>
</ul>
</div>
<div class="textblock"><p >Events are objects specifically designed for communication. They consist of event-signal and event-parameters. In the QP frameworks underlying QM, events are subclasses of the <code>QEvt</code> base class. QM such events by recognizing that a given class is a (direct or indirect) subclass of <code>QEvt</code> and by providing the <span class="img class_evt">event stereotype</span> for those classes. Additionally, event classes can be placed in <a class="el" href="bm_package.html#bm_package-stero">packages</a> with the <span class="img class_evt">event stereotype</span> </p>
<h1><a class="anchor" id="bm_evt-sig"></a>
Event Signals</h1>
<p >The event-signal provides information about the occurrence conveyed by the event. In QM, event-signals are used as <a class="el" href="sm_tran.html#sm_tran-trig">transition triggers</a>. Event-signals are typically enumerated in a <a class="el" href="ce_file.html">header file</a>, as illustrated in the following screen shot:</p>
<div class="image">
<img src="bm_evt-sig.png" alt=""/>
<div class="caption">
Event-signals enumerated in a header file</div></div>
<dl class="section attention"><dt>Attention</dt><dd>By the <b>QM convention</b>, the event signals must have the <b class="strong"><code>_SIG</code> suffix</b>. To avoid clutter, the <code>_SIG</code> suffix is omitted in the state diagrams. For example, the <code>MISSILE_FIRE_SIG</code> enumerated in the <code>game.hpp</code> header file appears as the <code>MISSILE_FIRE</code> trigger in a state diagram, but the QM code generator will add the <code>_SIG</code> suffix in the generating code. See also: <a class="el" href="sm_tran.html#sm_tran-trig">transition trigger</a>.</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The event-signals cannot start at zero, but must start with the <code>Q_USER_SIG</code> offset.</dd></dl>
<p>Currently, QM does not provide any more support for handling event-signals. In the future, QM will add support for partitioning the signal space and for associating event-signals with custom event classes.</p>
<h1><a class="anchor" id="bm_evt-param"></a>
Event Parameters</h1>
<p >The purpose of subclassing <code>QEvt</code> is to create events with <b>parameters</b>. These parameters are added in subclasses of <code>QEvt</code> as <a class="el" href="bm_attr.html">attributes</a> of the event classes.</p>
<div class="image">
<img src="bm_evt_c.png" alt=""/>
<div class="caption">
Event classes (subclasses of QEvt) in an events package</div></div>
<p >For example, the event class <code>ObjectImageEvt</code> in the screen shot above specifies the following event parameters:</p>
<div class="fragment"><div class="line">x : uint8_t</div>
<div class="line">y : int8_t</div>
<div class="line">bmp : uint8_t</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>When adding event parameters you should keep in mind the <b>size</b> of the event class. The instances of event classes are stored in the QP event pools, which then must be sized accordingly. Also, you typically should keep event classes simple PODs (Plain Old Datatypes), meaning that you should not provide constructors, destructors, virtual functions (in C++), etc.</dd></dl>
<h1><a class="anchor" id="bm_evt-decl"></a>
Declaring Event Classes</h1>
<p >Once the event classes are specified in the QM model, you typically need to provide the <b>declaration</b> of these classes in a header file. A header file is the right place, because events are <em>shared</em> among components, so they typically need to be included in multiple modules (<code>.c</code> or <code>.cpp</code> files).</p>
<p >You can <a class="el" href="ce_declare.html">declare</a> event classes in a <a class="el" href="ce_file.html">header file</a> either one at a time:</p>
<div class="image">
<img src="bm_evt_decl.png" alt=""/>
<div class="caption">
Declaring individual event classes</div></div>
<p >Alternatively, if you placed all your events in an dedicated package, you can simply generate <a class="el" href="ce_declare.html">declaration of the whole package</a>:</p>
<div class="image">
<img src="bm_evt_decl-pkg.png" alt=""/>
<div class="caption">
Declaring the whole event package</div></div>
<p >The latter declaration (the whole event package) results in the following generated code:</p>
<div class="fragment"><div class="line"><span class="comment">/*.$file${.::game.h} vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv*/</span></div>
<div class="line">. . .</div>
<div class="line"><span class="comment">/*.$declare${Events} vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv*/</span></div>
<div class="line"><span class="comment">/*.${Events::ObjectPosEvt} .................................................*/</span></div>
<div class="line">typedef <span class="keyword">struct </span>{</div>
<div class="line"><span class="comment">/* protected: */</span></div>
<div class="line">    QEvt super;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* public: */</span></div>
<div class="line">    uint8_t x;</div>
<div class="line">    uint8_t y;</div>
<div class="line">} ObjectPosEvt;</div>
<div class="line"><span class="comment">/*.${Events::ObjectImageEvt} ...............................................*/</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><span class="comment">/* protected: */</span></div>
<div class="line">    QEvt super;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* public: */</span></div>
<div class="line">    uint8_t x;</div>
<div class="line">    int8_t y;</div>
<div class="line">    uint8_t bmp;</div>
<div class="line">} ObjectImageEvt;</div>
<div class="line"><span class="comment">/*.${Events::MineEvt} ......................................................*/</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><span class="comment">/* protected: */</span></div>
<div class="line">    QEvt super;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* public: */</span></div>
<div class="line">    uint8_t id;</div>
<div class="line">} MineEvt;</div>
<div class="line"><span class="comment">/*.${Events::ScoreEvt} .....................................................*/</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><span class="comment">/* protected: */</span></div>
<div class="line">    QEvt super;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* public: */</span></div>
<div class="line">    uint16_t score;</div>
<div class="line">} ScoreEvt;</div>
<div class="line"><span class="comment">/*.$enddecl${Events} ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^*/</span></div>
<div class="line">. . .</div>
</div><!-- fragment --><h1><a class="anchor" id="bm_evt-using"></a>
Using Event Classes in the Code</h1>
<p >As mentioned before, the purpose of custom event classes is to represent events with parameters. So now, in the code you need to access the event parameters. The QP/C and QP/C++ frameworks provide special macro <code>Q_EVT_CAST()</code> to encapsulate the <b>down-casting</b> the current event <code>e</code> to the specific subclass of <code>QEvt</code> and then to conveniently access the event parameters. This is illustrated in the screen shot below:</p>
<div class="image">
<img src="bm_evt-use.png" alt=""/>
<div class="caption">
Using custom event in a transition action</div></div>
<dl class="section note"><dt>Note</dt><dd>The macro <code>Q_EVT_CAST()</code> encapsulates the deviation of MISRA-C/C++ rules of casting pointers.</dd></dl>
<hr  />
<p><b>Next:</b> <a class="el" href="bm_diagram.html">Working with Diagrams</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2021 Quantum Leaps</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
