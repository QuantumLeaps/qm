<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QM: Working with Class Operations</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="ql-awesome.css" rel="stylesheet" type="text/css"/>
<link href="qm.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
  <div id="projectlogo">
    <a href="https://www.state-machine.com" title="Quantum Leaps"><img alt="Logo" src="logo_ql.png"/></a>
  </div>
   <div id="projectname">
    <doxygen-awesome-dark-mode-toggle id="dark-mode-toggle" title="Toggle Light/Dark Mode"></doxygen-awesome-dark-mode-toggle>
    QM
    &nbsp;<span id="projectnumber">5.1.3</span>
   </div>
   <div id="projectbrief">Model-Based Design Tool</div>
   <div style="padding: 0.5em;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)"
               onblur="searchBox.OnSearchFieldFocus(false)"
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;"
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('bm_oper-class.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0"
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Working with Class Operations </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#bm_class-ctor">Class Constructors</a><ul><li class="level2"><a href="#bm_class-ctor_C">Class Constructors in C</a><ul><li class="level3"><a href="#bm_class-ctor_call">Invoking Constructors of Static Objects in C</a></li>
</ul>
</li>
<li class="level2"><a href="#bm_class-ctor_Cpp">Class Constructors in C++</a><ul><li class="level3"><a href="#bm_class-ctor_initializer">C++ Constructor Initializer List</a></li>
<li class="level3"><a href="#bm_class-ctor_explicit">Explicit Constructor in C++</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#bm_class-xtor">Class Destructors</a><ul><ul><li class="level3"><a href="#bm_class-xtor_C">Class Destructors in C</a></li>
<li class="level3"><a href="#bm_class-xtor_Cpp">Class Destructors in C++</a></li>
</ul>
</ul>
</li>
<li class="level1"><a href="#bm_class-oper-static">Static (Class-Wide) Operations</a></li>
<li class="level1"><a href="#bm_class-oper-prop">Class Operation Property Sheet</a></li>
</ul>
</div>
<div class="textblock"><p >Operations attached to a <a class="el" href="bm_class.html">class</a> can access individual instances of the class, except for a <a class="el" href="bm_oper-class.html#bm_class-oper-static">static class operation</a>, which is cannot access any particular instance. </p>
<p >In C, a non-static class operation corresponds to a function that (by a coding convention) takes the "me" pointer to the <code>struct</code> with class attribute (e.g., <code>bool Calc_eval(Calc * const me, double op, uint8_t oper)</code>).</p>
<div class="image">
<img src="bm_class-oper_c.png" alt=""/>
<div class="caption">
Example of a class operation in C</div></div>
<p >In C++, a non-static class operation corresponds to a class member function, that is a function with the "this"-calling convention (e.g., (e.g., <code>bool Calc::eval(double op, std::uint8_t oper)</code>).</p>
<div class="image">
<img src="bm_class-oper_cpp.png" alt=""/>
<div class="caption">
Example of a class operation in C++</div></div>
<h1><a class="anchor" id="bm_class-ctor"></a>
Class Constructors</h1>
<p >A constructor is a special kind of class operation that initializes an instance of its class. QM supports class constructors both for C and C++.</p>
<h2><a class="anchor" id="bm_class-ctor_C"></a>
Class Constructors in C</h2>
<p >In C, a constructor should be named <code>ctor</code>, or <code>ctor1</code>, <code>ctor2</code>, etc. if you have more constructors with different signatures (different parameters). The <code>ctor</code> function should have return type <code>void</code>. It can have any number of parameters.</p>
<div class="image">
<img src="bm_class-ctor_c.png" alt=""/>
<div class="caption">
Class constructor in C</div></div>
<p >This piece of the model generates the following code:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Philo_ctor(Philo * <span class="keyword">const</span> me) {</div>
<div class="line">    QActive_ctor(&amp;me-&gt;super, Q_STATE_CAST(&amp;Philo_initial));</div>
<div class="line">    QTimeEvt_ctorX(&amp;me-&gt;timeEvt, &amp;me-&gt;super, TIMEOUT_SIG, 0U);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The C constructor must always call the superclass' as well as members' constructors explicitly. For example, the <code>Philo_ctor()</code> in the listing above calls the superclass' constructor <code>QActive_ctor()</code> as well as member constructor <code>QTimeEvt_ctorX()</code>.</dd></dl>
<h3><a class="anchor" id="bm_class-ctor_call"></a>
Invoking Constructors of Static Objects in C</h3>
<p >In C, constructors of global/static objects are <b>not</b> invoked automatically, as it is the case in C++. Therefore, in C, <b>you</b> need to call the constructors of all your global/static objects explicitly. This often poses a problem with <b>encapsulation</b> of components, such as Active Objects, where you don't want to expose the whole class declaration (to get to the constructor). In that cases, the example models in QP/C use an idiom, in which the special <a class="el" href="bm_oper-free.html">free operation</a> <code>&lt;Class&gt;_ctor_caller()</code> (or just <code>&lt;Class&gt;_ctor()</code>) is provided just to call the constructor.</p>
<p >For example, the model in the screen shot above contains the free operation <code>Philo_ctor_call()</code>, which is defined as follows</p>
<div class="fragment"><div class="line"><span class="comment">/* definition provided in the philo.c module */</span></div>
<div class="line"><span class="keywordtype">void</span> Philo_ctor_call(<span class="keywordtype">void</span>) {</div>
<div class="line">    uint8_t n;</div>
<div class="line">    <span class="keywordflow">for</span> (n = 0U; n &lt; N_PHILO; ++n) {</div>
<div class="line">        Philo_ctor(&amp;Philo_inst[n]); <span class="comment">/* &lt;== ctor */</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >This particular "ctor call" invokes constructors of all <code>Philo</code> instances in the system. Later, in the <code>main()</code> function, only the <code>Philo_ctor_call()</code> operation is called, without exposing the declaration of the <code>Philo</code> class (and its constructor):</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    . . .</div>
<div class="line">    <span class="comment">/* start the active objects... */</span></div>
<div class="line">    Philo_ctor_call(); <span class="comment">/* &lt;== call all Philosopher ctors */</span></div>
<div class="line">    <span class="keywordflow">for</span> (n = 0U; n &lt; N_PHILO; ++n) {</div>
<div class="line">        QACTIVE_START(AO_Philo[n], <span class="comment">/* AO to start */</span></div>
<div class="line">        . . .</div>
<div class="line">     }</div>
<div class="line">     . . .</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="bm_class-ctor_Cpp"></a>
Class Constructors in C++</h2>
<p >In C++, a constructor has the same name as the class and no return value. A constructor can have any number of parameters and a class may have any number of overloaded constructors. Constructors may have any accessibility, public, protected or private.</p>
<h3><a class="anchor" id="bm_class-ctor_initializer"></a>
C++ Constructor Initializer List</h3>
<p >To provide the <b>constructor initializer list</b>, you put the list in the <em>code</em> panel starting with the colon (':') optionally preceded by any number of spaces. You can continue the list for as many lines as you wish.</p>
<p >The <b>constructor initializer list</b> might be followed by the body of the constructor. To start the body, you simply leave one (or more) empty lines after the initializer. QM will interpret all lines of code after such an empty line as the body of the constructor.</p>
<p >Finally, you might skip the <b>constructor initializer list</b> altogether by simply not placing the colon (':') at the beginning.</p>
<p >The following screen shot shows a C++ constructor with a <b>constructor initializer list</b> and a body.</p>
<div class="image">
<img src="bm_class-ctor_cpp.png" alt=""/>
<div class="caption">
Class constructor in C++</div></div>
<p >This piece of the model generates the following code:</p>
<div class="fragment"><div class="line">Table::Table() noexcept</div>
<div class="line">  : QActive(&amp;initial)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (uint8_t n = 0U; n &lt; N_PHILO; ++n) {</div>
<div class="line">        m_fork[n] = FREE;</div>
<div class="line">        m_isHungry[n] = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="bm_class-ctor_explicit"></a>
Explicit Constructor in C++</h3>
<p >You can make a C++ constructor <b>explicit</b> by providing the keyword <code>explict</code> in the <b>return type</b> filed in the Property Sheet. An example of an explicit constructor is provided in the <code>Table</code> constructor shown in the scren shot above.</p>
<h1><a class="anchor" id="bm_class-xtor"></a>
Class Destructors</h1>
<p >A destructor is a kind of class operation that cleans up after an instance of its class. QM supports class destructors both for C and C++.</p>
<h3><a class="anchor" id="bm_class-xtor_C"></a>
Class Destructors in C</h3>
<p >In C, a destructor should be named <code>xtor</code>. The <code>xtor</code> class operation should have return type <code>void</code> and should not take any parameters (except of the implicit <code>me</code> pointer).</p>
<dl class="section note"><dt>Note</dt><dd>The C constructor must always call the superclass' constructor explicitly.</dd></dl>
<h3><a class="anchor" id="bm_class-xtor_Cpp"></a>
Class Destructors in C++</h3>
<p >In C++, a destructor should be named <code>~&lt;Class&gt;</code>. The destructor class operation should have no return type and should not take any parameters (except of the implicit <code>this</code> pointer).</p>
<h1><a class="anchor" id="bm_class-oper-static"></a>
Static (Class-Wide) Operations</h1>
<p >Static class operation does not have access to any specific instance of a class, but has permissions to access any attributes of any instance of the class. In C, a static class operation does <b>not</b> take the "me" pointer. Similarly, in C++, a static class operation does <b>not</b> take the implicit "this" pointer. You make a given class operation <code>static</code> by checking the <b>static</b> checkbox in the <a class="el" href="bm_oper-class.html#bm_class-oper-prop">Class Operation Property Sheet</a>.</p>
<h1><a class="anchor" id="bm_class-oper-prop"></a>
Class Operation Property Sheet</h1>
<div class="image">
<img src="bm_class-oper_prop.png" alt=""/>
<div class="caption">
Class operation Property Sheet</div></div>
<p >The class operation property sheet allows you to set the following properties:</p>
<ul>
<li><b>operation name</b></li>
<li><b>operation return type</b> drop-down box (NOTE: accepts also user-supplied types)</li>
<li><b>operation specifier</b> (C++ only) allow you to provide such specifiers as: <code>override</code>, <code>noexcept</code>, <code>=delete</code>, <code>=0</code>, etc.</li>
<li><b>operation virtual</b> (C++ only) chcekbox</li>
<li><b>operation inline</b> (C++ only) chcekbox</li>
<li><b>operation documentation</b> for documenting the operation (see also <a class="el" href="ce_comment.html#ce_comment-doc">generate comments</a>)</li>
<li><b>operation code/pseudocode</b> for specifying code of the operation (NOTE: the pseudocode box is currently not used)</li>
</ul>
<hr  />
<p><b>Next:</b> <a class="el" href="bm_oper-free.html">Working with Free Operations</a></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; 2005-2021 Quantum Leaps</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
<hr class="footer"/><address class="footer"><small>
<a title="Quantum Leaps: Modern Embedded Software" href="https://www.state-machine.com">&copy; Quantum Leaps 2020</a> &nbsp;| &nbsp; <a title="help" href="help.html">Using Online Help</a>&nbsp;| &nbsp;<a title="Doxygen" href="http://www.doxygen.nl">Generated with Doxygen</a>&nbsp; | &nbsp;<b>QM 5.1.3</b>
</small></address>
    </li>
  </ul>
</div>
</body>
</html>
